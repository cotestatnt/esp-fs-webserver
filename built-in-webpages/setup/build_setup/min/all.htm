<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ESP FS Web Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>:root{--c-1:#06b6d4;--c-1-d:#0891b2;--c-2:#f0f9ff;--c-2-d:#e0f2fe;--c-t:#1e3a5f;--c-t-l:#64748b7d;--g-a:#0f172a;--g-b:#1e3a5f;--s-1:0 4px 12px rgba(6,182,212,.3)}html{font-family:sans-serif}body{background:linear-gradient(135deg,var(--g-a) 0,var(--g-b) 100%);color:var(--c-t);min-height:100vh;padding:0 20px 20px}a,a:active,a:hover{color:inherit;outline:0;text-decoration:none}.bar,.foot,.form,.fw,.hd,.hsw,.ic,.ldr,.pswd,.slw,.tab,.tabs,.tglw,.title,.tw{display:flex}.foot{flex-direction:column-reverse}.foot,.form{align-items:center}.form{width:100%}.ctn,.form{flex-direction:column}.ctn{background:linear-gradient(135deg,#e0f2fe65,#f0f9fff2);border:1px solid var(--c-1);border-radius:12px;box-shadow:0 8px 24px #06b6d433;display:flex;margin:0 auto 6px;max-width:840px;padding:8px 40px;position:relative}.header-main{min-height:130px}.row-w{align-items:baseline;gap:20px;margin-bottom:14px}.tw{align-items:center;flex-direction:column;margin-bottom:10px}h1{font-size:36px;margin:10px 0 5px}h2{font-size:24px;font-weight:600;margin:4px auto}ul{color:#e2e8f0;display:table;margin:0 auto 10px}input[type=number],input[type=password],input[type=text],select{background:var(--c-2);border:1px solid var(--c-t-l);border-radius:8px;color:#0f172a;font-size:16px;height:40px;padding:0 0 0 20px;width:90%}input:focus,select:focus{border-color:var(--c-1-d);box-shadow:0 0 16px #06b6d44d;outline:0}input[type=checkbox]{box-sizing:border-box;padding:0}.hide,.hide-tiny.hide,input[type=file]{display:none}input::placeholder{color:var(--c-t-l)}.slw:hover,input:hover,select:hover{border-color:var(--c-1-d);box-shadow:0 0 12px #06b6d433}select{width:92.5%}.lbl{align-self:flex-start;background:var(--c-2-d);border:1px solid var(--c-t-l);border-radius:6px;bottom:-5px;color:var(--c-1-d);font-size:13.5px;font-weight:600;left:5%;padding:2px 10px 0;position:relative;transition:.3s}.lbl:hover{background:#cffafe;border-color:var(--c-1)}.btn,.fwu,button{align-items:center;background:linear-gradient(135deg,var(--c-1) 0,var(--c-1-d) 100%);border:0;border-radius:5px;box-shadow:var(--s-1);color:#fff;cursor:pointer;display:flex;font-weight:600;justify-content:center;min-width:40%;padding:10px;transition:.3s}.btn.load,.fwu[aria-disabled=true]{box-shadow:none;cursor:default;opacity:.3;pointer-events:none}.btn.small{background:linear-gradient(135deg,#ef4444,#b91c1c);box-shadow:0 2px 6px #ef44444d;font-size:14px;min-width:0;padding:8px 16px;width:110px}.logo{margin:10px;width:128px}hr{border:1px solid #06b6d44d;order:997;width:100%}.fw{gap:10px}#update-btn{background:#942a07;min-width:0}.tglw{flex-wrap:wrap;gap:20px;justify-content:flex-start;margin-bottom:15px}.tgl{cursor:pointer;display:inline-block;margin-left:-12px;padding:4px}.tlbl{color:#0f172a;font-weight:500;margin:0 10px;top:2px}.tlbl,.tsw{position:relative}.tsw{background:#cbd5e1;border-radius:10px;display:inline-block;height:32px;transition:background .25s;vertical-align:middle;width:58px}.tsw:before{background:linear-gradient(to bottom,#fff 0,var(--c-2) 100%);border-radius:50%;box-shadow:0 0 0 1px #06b6d44d;content:"";display:block;height:24px;left:4px;position:absolute;top:4px;transition:left .25s;width:24px}.tc:checked+.tsw{background:linear-gradient(135deg,var(--c-1) 0,var(--c-1-d) 100%)}.tc:checked+.tsw:before{background:linear-gradient(to bottom,var(--c-2) 0,var(--c-2-d) 100%);left:30px}.tc{position:absolute;visibility:hidden}.lbl-wifi{margin-left:0}.slw{align-items:center;background:var(--c-2);border:1px solid var(--c-t-l);border-radius:8px;gap:14px;width:92.5%}.slw .sl{appearance:none;background:#e2e8f0;border-radius:999px;box-shadow:inset 0 1px 2px #0f172a1f;height:10px;margin-left:20px;outline:0;transition:.2s;width:100%}.slw .sl::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background:linear-gradient(135deg,var(--c-1) 0,var(--c-1-d) 100%);border:2px solid var(--c-2-d);border-radius:50%;box-shadow:0 2px 6px #06b6d466;cursor:pointer;height:20px;width:20px}.slw .slr{border:0;height:40px;text-align:center;width:60px}.ldr{background:linear-gradient(180deg,#0f172af2,#0f172acc 50%,#0f172af2);flex-direction:column;inset:0;justify-content:center;position:fixed}.sH{animation:sH 3s ease-out infinite;background:var(--c-1);border-radius:100%;box-shadow:0 0 10px var(--c-1);height:10px;position:absolute;top:52%;width:10px}.s2H{animation-delay:.1s;animation-timing-function:linear}.s3H{animation-delay:.2s;animation-timing-function:linear}.s4H{animation-delay:.3s;animation-timing-function:linear}.s5H{animation-delay:.4s;animation-timing-function:cubic-bezier(.4,0,1,1)}@keyframes sH{0%{transform:translateX(0)}20%{transform:translate(200px)}70%{transform:translateX(505px)}to{transform:translateX(800px)}}.pgw{background:#06b6d41a;border:2px solid var(--c-1);border-radius:8px;cursor:pointer;font-size:20px;height:25px;margin:20px auto;position:relative;text-align:center;transition:.4s;width:80%}.pgw:not(.active){background:#06b6d40d}.pgw .pg{background:linear-gradient(90deg,var(--c-1) 0,var(--c-1-d) 100%);inset:0;opacity:0;position:absolute;transition:.3s;width:0;z-index:5}.pgw.active .pg{opacity:1}.mod{background:linear-gradient(135deg,var(--c-2) 0,var(--c-2-d) 100%);border:2px solid var(--c-1);border-radius:12px;box-shadow:0 8px 32px #06b6d44d;flex-direction:column;min-width:400px;position:relative}#modal{align-items:center;display:none;inset:0;justify-content:center;position:fixed;z-index:1000}#modal[open]{display:flex}#modal:before{backdrop-filter:blur(1px);background:#00000059;content:"";inset:0;position:fixed;z-index:-1}.mt{font-weight:600;width:calc(100% - 4.5em)}.mc,.mt{color:#0f172a;padding:1.5em}.mc{border-top:2px solid var(--c-1);overflow:auto}.nav{align-self:flex-end;background:linear-gradient(135deg,var(--g-a) 0,var(--g-b) 100%);border:1px solid var(--c-1);margin-top:12px}.nav a{color:#e2e8f0;cursor:pointer;float:left;font-size:16px;padding:6px 12px}.nav a:hover{color:var(--c-1)}.nav a.active{background:linear-gradient(180deg,var(--c-1) 0,#026881 100%);color:#fff;font-weight:600}.nav .icon{display:none}.nav.inline-header{align-items:center;display:inline-flex}.title{margin:-10px 0 -14px}.hd{align-items:stretch;color:var(--c-1-d);flex-direction:column;text-align:right}.hd,.pswd{width:100%}.pswd{align-items:center;flex-direction:row;justify-content:center}.shw{color:var(--c-1);cursor:pointer;position:absolute;right:10%}.bar{flex-wrap:wrap;gap:20px 30px;justify-content:center;order:998;padding:10px}.bar.compact{align-items:center;display:flex;gap:10px;padding:0}.ic{margin-right:10px;width:20px}.table{border-collapse:collapse;margin:auto;width:90%}.hsw{flex-direction:row;justify-content:flex-start;margin-bottom:20px;width:93%}.port{width:15%}.tabs{align-items:flex-end;margin:10px 0 0}.tab{align-items:center;background:var(--g-b);border-radius:8px 8px 0 0;color:#8f9195;font-size:14px;justify-content:center;margin-right:4px;max-width:150px;min-width:auto;overflow:hidden;padding:8px 12px;text-overflow:ellipsis;white-space:nowrap}.tab.active{background:var(--c-2-d);border-bottom:2px solid var(--c-1);border:2px solid var(--c-1);border-bottom-color:var(--c-2-d);box-shadow:none;color:var(--c-1-d);position:relative;top:2px;z-index:2}.tw.inline-creds{flex-direction:row-reverse;justify-content:end;width:100%}tr:hover{background:var(--c-t-l);cursor:pointer}#w-tbl,#wifi{background:var(--c-2-d);border:2px solid var(--c-1);margin-bottom:10px;padding:20px}#w-tbl{margin-bottom:-2px}#show-networks{margin-right:10px}#about{color:var(--c-t-l);font-size:10pt}#about:hover{color:var(--c-2)}@media screen and (max-width:608px){h1{font-size:24px}.bar{margin-top:20px}.nav{align-self:flex-start;margin:4px;min-width:200px;width:auto}.nav a{padding:5px 12px}.nav a.active{background:none}.hide-tiny,.nav a:not(.active),.nav.responsive .icon{display:none}.nav a.icon{display:block}.nav.responsive{flex-direction:column;width:auto}.nav.responsive a{display:block;float:none;text-align:left;width:100%}.hsw{width:96%}.port{margin-right:12px}}@media screen and (max-width:479px){body{padding:2px}select{width:95.5%}.ctn{padding:0 10px}}</style>
  <script>const ICONS={lock:"ðŸ”’",unlock:"ðŸ”“",scan:"ðŸ“¡",connect:"ðŸ“¶",save:"ðŸ’¾",restart:"â†»",eye:"ðŸµ",noEye:"ðŸ™ˆ",menu:"â˜°",del:"ðŸ—‘ï¸",clear:"âœ–",upload:"âœ…"},$=e=>document.getElementById(e),hide=e=>{const t=$(e);t&&t.classList.add("hide")},show=e=>{const t=$(e);t&&t.classList.remove("hide")},newEl=(e,t={})=>{const n=document.createElement(e);for(const[e,a]of Object.entries(t))n.setAttribute(e,a);return n},port=location.port||("https:"===location.protocol?"443":"80");let config,configPath,modalCloseCb,esp=`${location.protocol}//${location.hostname}:${port}/`,wifiCredentials=[],selectedCredentialIndex=-1;const loadedAssets={css:new Set,js:new Set,html:new Set};function openModal(e,t,n){$("message-title").innerHTML=e,$("message-body").innerHTML=t,$("modal").open=!0,$("main").style.filter="blur(3px)",modalCloseCb="function"==typeof n?n:null,n?show("ok-modal"):hide("ok-modal")}function closeModal(e){$("modal").open=!1,$("main").style.filter="",e&&modalCloseCb&&modalCloseCb(),modalCloseCb=null}window.openModal=openModal,window.closeModal=closeModal;const confirmRestart=()=>openModal("Restart","Restart now?",restartESP),restartESP=()=>fetch(`${esp}reset`).then(()=>{closeModal(!1),openModal("Restarted","ESP restarted")});function setupHeaderLayout(){const e=()=>{const e=document.querySelector("header.ctn"),t=e?.querySelector(".title"),n=t?.querySelector(".hd"),a=$("top-nav");e&&n&&a&&(window.innerWidth<=608?(a.parentNode!==e&&e.insertBefore(a,t.nextSibling),a.classList.remove("inline-header")):(a.parentNode!==n&&n.appendChild(a),a.classList.add("inline-header")))};e(),window.onresize=e}function applyIcons(){const e={"svg-menu":ICONS.menu,"svg-eye":ICONS.eye,"svg-no-eye":ICONS.noEye,"svg-scan":ICONS.scan,"svg-connect":ICONS.connect,"svg-save":ICONS.save,"svg-restart":ICONS.restart,"svg-delete":ICONS.del,"svg-clear":ICONS.clear,"svg-update":ICONS.upload};for(const[t,n]of Object.entries(e)){const e=$(t);e&&(e.textContent=n)}}function applyStatusHeader(e){if($("esp-mode")&&($("esp-mode").textContent=e.mode||""),$("firmware")&&($("firmware").textContent=e.firmware||""),$("about")&&($("about").href=e.liburl||"#",$("about").textContent=e.liburl?"Created with "+e.liburl:""),$("esp-ip")){const t=e.hostname||location.hostname;$("esp-ip").innerHTML=`<a href="http://${t}.local/">http://${t}.local</a><a href="${esp}"> (${e.ip||""})</a>`}configPath=e.path,$("hostname")&&($("hostname").value=e.hostname||""),$("ssid-name")&&($("ssid-name").textContent="SSID")}function applyMetaFromConfig(e){if(console.log(e),!e||"object"!=typeof e)return;const t=e._meta||{},n=$("img-logo")?.querySelector("img");if(n&&!n.src&&(n.src=t.logo||"config/logo.svg",$("img-logo").classList.remove("loading")),t.app_title){const e=t.app_title.replace(/(<([^>]+)>)/gi,"");$("page-title").textContent=e,document.title=e}$("port")&&"number"==typeof t.port&&($("port").value=t.port,show("port-w"))}function loadAssets(e){e&&"object"==typeof e&&((e.css||[]).forEach(e=>{loadedAssets.css.has(e)||(loadedAssets.css.add(e),document.head.appendChild(newEl("link",{rel:"stylesheet",href:e})))}),(e.js||[]).forEach(e=>{loadedAssets.js.has(e)||(loadedAssets.js.add(e),document.body.appendChild(newEl("script",{src:e})))}))}function clearDynamicContent(){document.querySelectorAll(".box.dyn").forEach(e=>e.remove()),document.querySelectorAll("#nav-link a[data-dynamic='1']").forEach(e=>e.remove())}function buildElement(e,t,n,a){const s=`opt-${t}-${n}`;let o,i;if("html"===e.type)o=newEl("div"),e.value&&fetch(e.value).then(e=>e.text()).then(e=>o.innerHTML=e).catch(()=>o.textContent="Error");else if("boolean"===e.type)o=newEl("label",{class:"lbl tgl",for:s}),i=newEl("input",{id:s,type:"checkbox",class:"tc in"}),i.checked=!!e.value,o.append(i,newEl("div",{class:"tsw"}),Object.assign(newEl("span",{class:"tlbl"}),{textContent:e.label||""}));else if(o=newEl("div",{class:"tw"}),o.appendChild(Object.assign(newEl("label",{class:"lbl",for:s}),{textContent:e.label||""})),"select"===e.type)i=newEl("select",{id:s,class:"in"}),(e.options||[]).forEach(t=>i.add(new Option(t,t,!1,String(t)===String(e.value)))),o.appendChild(i);else if("slider"===e.type){const a=newEl("div",{class:"slw"});i=newEl("input",{id:s,type:"range",class:"in sl",min:e.min??0,max:e.max??100,step:e.step??1}),i.value=e.value??e.min??0;const l=newEl("input",{id:s+"-readout",type:"number",class:"in slr",min:i.min,max:i.max,step:i.step});l.value=i.value,l.dataset.secIndex=t,l.dataset.elIndex=n,a.append(i,l),o.appendChild(a)}else{const t="number"===e.type?"number":"text";i=newEl("input",{id:s,type:t,class:"in"}),"number"===t&&(null!=e.min&&(i.min=e.min),null!=e.max&&(i.max=e.max),null!=e.step&&(i.step=e.step)),i.value=e.value??"",o.appendChild(i)}i&&(i.dataset.secIndex=t,i.dataset.elIndex=n),e.hidden&&o.classList.add("hide"),a.appendChild(o)}function buildSectionsFromConfig(){if(clearDynamicContent(),!config||!Array.isArray(config.sections))return;const e=$("main"),t=$("btn-hr");config.sections.forEach((n,a)=>{const s=`option-box-${a}`,o=newEl("div",{class:"ctn box dyn hide",id:s}),i=newEl("h2");i.textContent=n.title||`Options ${a+1}`,o.appendChild(i),e.insertBefore(o,t);const l=newEl("a",{class:"a-link",id:`set-opt-${a}`,"data-box":s,"data-dynamic":"1"});l.textContent=n.title||`Options ${a+1}`,l.onclick=switchPage,$("nav-link").appendChild(l);const d=newEl("div",{class:"tglw"});o.appendChild(d),(n.elements||[]).forEach((e,t)=>{const n="boolean"===e.type?d:o;buildElement(e,a,t,n)})})}function handleOptionChange(e){const t=e.target;if(!t.classList.contains("in"))return;let n=t;if(t.id&&t.id.endsWith("-readout")){const e=$(t.id.replace(/-readout$/,""));e&&(n=e)}const a=n.dataset.secIndex,s=n.dataset.elIndex;if(null==a||null==s||!config||!Array.isArray(config.sections))return;const o=((config.sections[Number(a)]||{}).elements||[])[Number(s)];o&&("boolean"===o.type?o.value=!!n.checked:"slider"===o.type||"number"===o.type?o.value=Number(n.value):(o.type,o.value=n.value))}function handleOptionInput(e){const t=e.target;if("range"===t.type&&t.classList.contains("in")){const e=$(`${t.id}-readout`);e&&(e.value=t.value)}handleOptionChange(e)}async function loadCredentials(){try{const e=await fetch(`${esp}wifi/credentials?_=${Date.now()}`);if(!e.ok)return;if(wifiCredentials=await e.json(),selectedCredentialIndex=wifiCredentials.length?0:-1,wifiCredentials.length>1)if("undefined"==typeof renderCredentialTabs){const e=document.createElement("script");e.src="creds.js",e.onload=()=>window.renderCredentialTabs&&window.renderCredentialTabs(),document.body.appendChild(e)}else window.renderCredentialTabs();else $("wifi-cred-tabs")&&($("wifi-cred-tabs").innerHTML=""),["delete-cred","clear-creds","cred-actions-inline"].forEach(hide);selectedCredentialIndex>=0&&wifiCredentials[0]&&window.applyCredential(wifiCredentials[0])}catch(e){console.error(e)}}function hasStoredCredentialFor(e){return wifiCredentials.some(t=>t.ssid===e)}function getWiFiList(){const e=$("scan-wifi");e.classList.add("load"),fetch(`${esp}scan`).then(e=>e.json()).then(t=>{t.reload&&setTimeout(getWiFiList,2e3),t.sort((e,t)=>t.strength-e.strength);const n=$("w-lst");n.innerHTML="";const a=document.createDocumentFragment();t.forEach((e,t)=>{const n=newEl("tr",{id:`wifi-${t}`});n.innerHTML=`<td><input type="radio" name="select" id="select-wifi-${t}"></td><td>${e.ssid}</td><td class="hide-tiny">${e.strength} dBm</td><td>${e.security?ICONS.lock:ICONS.unlock}</td>`,n.onclick=()=>{$("ssid").value=e.ssid,$("ssid-name").textContent=e.ssid,$("password").focus();try{$(`select-wifi-${t}`).checked=!0}catch(e){}$("w-tbl").classList.add("hide"),show("show-networks")},a.appendChild(n)}),n.appendChild(a),show("w-tbl"),e.classList.remove("load")}).catch(()=>hide("loader"))}function doConnection(e,t){const n=$("ssid").value,a=$("password").value;if(!n||!a&&!hasStoredCredentialFor(n))return openModal("WiFi","Insert SSID & Password");const s=new FormData;s.append("ssid",n),s.append("password",a),s.append("persistent",$("persistent").checked);const o=$("hostname")?$("hostname").value.trim():"";if(o&&s.append("hostname",o),!$("dhcp").checked){s.append("ip_address",$("ip").value),s.append("gateway",$("gateway").value),s.append("subnet",$("subnet").value);const e=$("dns1").value.trim(),t=$("dns2").value.trim();e&&s.append("dns1",e),t&&s.append("dns2",t)}t&&s.append("confirmed","true"),show("loader"),fetch("/connect",{method:"POST",body:s}).then(t=>t.text().then(n=>{hide("loader"),200!==t.status?openModal("Error",n):n.includes("action-confirm-sta-change")?openModal("WiFi",n,()=>doConnection(e,!0)):n.includes("action-restart-required")?openModal("WiFi",n,restartESP):n.includes("action-async-applying")&&openModal("WiFi",n)}))}function handleUpdate(){const e=$("file-input").files[0];if(!e)return;show("loader"),show("pgr-wrap"),$("pgr-wrap").classList.add("active"),$("update-log").textContent="Updating...";const t=new FormData;t.append("update",e);const n=new XMLHttpRequest;n.open("POST",`/update?size=${e.size}`),n.onload=()=>{hide("loader"),$("pgr-wrap").classList.remove("active"),$("update-log").textContent=200===n.status?n.responseText:"Error";const e=$("file-input"),t=$("fw-lbl");e&&(e.value=""),t&&(t.textContent=t.dataset.defaultText||"Select firmware binary file",t.removeAttribute("title"),t.style.background=""),$("update-btn")&&$("update-btn").setAttribute("aria-disabled","true"),$("pgr-anim")&&($("pgr-anim").style.width="0%"),hide("pgr-wrap")},n.upload.onprogress=e=>{e.lengthComputable&&$("pgr-anim")&&($("pgr-anim").style.width=`${Math.round(e.loaded/e.total*100)}%`)},n.send(t)}async function uploadFolder(e){const t=Array.from(e.target.files||[]);if(!t.length)return;const n=$("listing"),a=$("pick-lbl");if(n&&(n.innerHTML=""),a){a.setAttribute("aria-disabled","true"),a.style.background="brown";const e=a.dataset.defaultText||a.textContent;a.textContent=`${e} (${t.length} file${t.length>1?"s":""} selected)`}let s=0,o=0;for(const e of t){const t=e.webkitRelativePath.replace(/^data\//,""),a=newEl("li");a.textContent=t,n&&n.appendChild(a);const i=new FormData;i.append("data",e,"/"+t);try{(await fetch("/edit",{method:"POST",body:i})).ok?s++:(o++,a.style.color="red")}catch(e){o++,a.style.color="red"}}e.target&&(e.target.value=""),a&&(a.textContent=a.dataset.defaultText||"Select the folder containing your files",a.style.background="",a.removeAttribute("aria-disabled"));openModal("FS Upload",`<br>Uploaded <b>${s}</b> file${1!==s?"s":""}${o?`, <b>${o}</b> failed`:" successfully"}.`)}function switchPage(e){const t=e.target,n=t.getAttribute("data-box");if($("top-nav").classList.remove("responsive"),document.querySelectorAll("a").forEach(e=>e.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".box").forEach(e=>e.classList.add("hide")),show(n),"set-wifi"!==t.id){const e=$(n);e.appendChild($("btn-hr")),e.appendChild($("btn-box")),show("btn-box"),show("btn-hr")}else hide("btn-box"),hide("btn-hr")}function saveParameters(){if(!config||!configPath)return;if($("port")&&config._meta){const e=parseInt($("port").value,10);Number.isNaN(e)||(config._meta.port=e)}const e=new Blob([JSON.stringify(config,null,2)],{type:"application/json"}),t=new FormData;t.append("data",e,"/"+configPath),fetch("/edit",{method:"POST",body:t}).then(()=>openModal("Save",`<br>Saved config to <b>/${configPath}</b>`)).catch(e=>openModal("Error",`Save failed: ${e}`))}window.applyCredential=e=>{if(!e)return;$("ssid").value=e.ssid||"",$("ssid-name").textContent=e.ssid||"SSID";const t=e.ip&&"0.0.0.0"!==e.ip;$("dhcp").checked=!t,t?(show("conf-wifi"),$("ip").value=e.ip,$("gateway").value=e.gateway,$("subnet").value=e.subnet,$("dns1").value=e.dns1||"",$("dns2").value=e.dns2||""):(hide("conf-wifi"),$("ip").value="",$("gateway").value="",$("subnet").value="",$("dns1").value="",$("dns2").value=""),$("password").value=""},window.addEventListener("load",()=>{const e=$("main");e&&(e.addEventListener("change",handleOptionChange),e.addEventListener("input",handleOptionInput)),$("hum-btn")&&($("hum-btn").onclick=()=>$("top-nav").classList.toggle("responsive")),$("scan-wifi")&&($("scan-wifi").onclick=getWiFiList),$("connect-wifi")&&($("connect-wifi").onclick=e=>doConnection(e,!1)),$("save-params")&&($("save-params").onclick=saveParameters),$("set-wifi")&&($("set-wifi").onclick=switchPage),$("set-update")&&($("set-update").onclick=switchPage),$("restart")&&($("restart").onclick=confirmRestart),$("update-btn")&&($("update-btn").onclick=handleUpdate),$("ok-modal")&&($("ok-modal").onclick=()=>closeModal(!0)),$("close-modal")&&($("close-modal").onclick=()=>closeModal(!1)),$("picker")&&($("picker").onchange=uploadFolder),$("show-networks")&&($("show-networks").onclick=()=>{$("w-tbl").classList.toggle("hide"),$("show-networks").classList.toggle("hide")}),$("show-hide-password")&&($("show-hide-password").onclick=()=>{const e=$("password"),t="password"===e.type;e.type=t?"text":"password",t?(show("show-pass"),hide("hide-pass")):(hide("show-pass"),show("hide-pass"))}),$("ssid")&&$("ssid-name")&&$("ssid").addEventListener("input",()=>{const e=$("ssid").value.trim();$("ssid-name").textContent=e||"SSID"}),$("dhcp")&&($("dhcp").onchange=function(){this.checked?hide("conf-wifi"):show("conf-wifi")});const t=$("fw-lbl");t&&!t.dataset.defaultText&&(t.dataset.defaultText=t.textContent);const n=$("pick-lbl");n&&!n.dataset.defaultText&&(n.dataset.defaultText=n.textContent),$("update-btn")&&$("update-btn").classList.add("load"),$("file-input")&&($("file-input").onchange=function(){const e=$("fw-lbl");if(!this.files||!this.files.length||!e)return;const t=this.files[0];e.textContent=`${t.name} (${t.size} bytes)`,e.title=t.name,e.style.background="brown",$("update-btn")&&$("update-btn").classList.remove("load")}),applyIcons(),setupHeaderLayout(),show("loader"),fetch(`${esp}getStatus`).then(e=>e.json()).then(e=>{if(e.ip&&(esp=`${location.protocol}//${e.ip}:${port}/`),applyStatusHeader(e),!configPath)throw new Error("No config path");return fetch(`${esp}${configPath}`).then(e=>e.json())}).then(e=>{config=e,applyMetaFromConfig(e),loadAssets(e._assets||{}),buildSectionsFromConfig(),hide("loader"),document.body.classList.remove("boot-loading"),loadCredentials(),window.dispatchEvent(new Event("setupPageReady"))}).catch(()=>{hide("loader"),document.body.classList.remove("boot-loading")})});</script>
</head>
<body class="boot-loading">
  <main id="main">
  <header class="ctn header-main">
    <div class="title">
      <div id="img-logo" class="ldg"><img class="logo" alt="Logo"></div>
      <div class="hd">
        <h1 id="page-title">ESP FS Web Server</h1>
        <div id="esp-ip"></div>
        <div><span id="esp-mode"></span> - v<span id="firmware"></span></div>
      </div>
    </div>
    <div class="nav" id="top-nav">
      <a class="a-link icon" id="hum-btn"><div class="ic im"><span id="svg-menu"></span></div></a>
      <div id="nav-link"><a id="set-wifi" class="a-link active" data-box="wifi-box">WiFi Setup</a></div>
      <div id="upd-link"><a id="set-update" class="a-link" data-box="update-box">Update & FS</a></div>
    </div>
  </header>

  <div id="wifi-box" class="ctn box">
    <h2 class="h2">WiFi Credential Manager</h2>
    <div id="wifi-cred-tabs" class="tabs"></div>
      <div id="w-tbl" class="hide">
        <table class="table">
          <tbody id="w-lst"></tbody>
        </table>
        <br>
      </div>
      <div id="wifi">
        
        <div class="tw">
          <div class="hsw">
            <div class="host">
              <label for="hostname" class="lbl">Hostname</label>
              <input type="text" placeholder="Hostname for http://hostname.local" id="hostname" class="in">
            </div>
            <div class="port" id="port-w">
              <label class="lbl">Port</label>
              <input class="in" type="number" id="port">
            </div>
          </div>
          <hr>
        </div>
        
        
        <div class="tw">
          <label for="ssid" class="lbl">SSID</label>
          <div class="pswd">
              <input type="text" placeholder="Enter your WiFI SSID name" id="ssid" class="in">
                <span class="shw" id="show-hide-networks">
                  <a class="sh hide chevron-networks" id="show-networks">â–¼</a>
                </span>
          </div>
        </div>
        <div class="tw">
          <label for="password" class="lbl">Password</label>
          <div class="pswd">
            <input type="password" placeholder="Enter your WiFi password" id="password" autocomplete="current-password" class="in">
            <span class="shw" id="show-hide-password">
              <a class="sh hide" id="show-pass"><div class="ic"><span class="svg-e" id="svg-eye"></span></div></a>
              <a class="sh" id="hide-pass"><div class="ic"><span class="svg-e" id="svg-no-eye"></span></div></a>
            </span>  
          </div>
        </div>
        
        <div class="tw">
          <label class="lbl tgl">
            <input id="dhcp" type="checkbox" class="tc in" checked>
            <div class="tsw"></div>
            <span class="tlbl">DHCP enabled</span>
          </label>
        </div>
        
        <div class="hide" id="conf-wifi"> 
          <div class="tw">
              <label for="ip" class="lbl">IP Address</label>
              <input type="text" placeholder="IP Address" id="ip" value="192.168.0.10" class="in">
          </div>
          <div class="tw">
              <label for="gateway" class="lbl">Gateway</label>
              <input type="text" placeholder="Gateway address" id="gateway" value="192.168.0.1" class="in">
          </div>
          <div class="tw">
              <label for="subnet" class="lbl">Subnet</label>
              <input type="text" placeholder="Subnet mask" id="subnet" value="255.255.255.0" class="in">
          </div>
          <div class="tw">
            <label for="dns1" class="lbl">DNS 1 (optional)</label>
            <input type="text" placeholder="Primary DNS server" id="dns1" class="in">
          </div>
          <div class="tw">
            <label for="dns2" class="lbl">DNS 2 (optional)</label>
            <input type="text" placeholder="Secondary DNS server" id="dns2" class="in">
          </div>
        </div>
            
        <div class="tw inline-creds">
          <div id="cred-actions-inline" class="bar compact hide">
            <a id="delete-cred" class="btn small hide">
              <div class="ic"><span id="svg-delete"></span></div>
              <span>Delete SSID</span>
            </a>
            <a id="clear-creds" class="btn small hide">
              <div class="ic"><span id="svg-clear"></span></div>
              <span>Delete ALL</span>
            </a>
            <label class="lbl-wifi tgl">
              <input id="persistent" type="checkbox" class="tc in" checked>
              <div class="tsw"></div>
              <span class="tlbl">Save WiFi</span>
            </label>
          </div>
        </div>
      </div>
      <hr>
      <div class="bar">
          <a id="scan-wifi" class="btn">
            <div class="ic"><span id="svg-scan"></span></div>
              <span>Scan WiFi networks</span>
          </a>
          <a id="connect-wifi" class="btn">
            <div class="ic"><span id="svg-connect"></span></div>
              <span>Connect to <span id="ssid-name">SSID</span></span>
          </a>
      </div>
  </div>

  <div id="update-box" class="ctn box hide">
    <h2 class="h2">Update ESP Firmware</h2>
    <div class="tw">
      <form id="update-form" class="form" action="/update" method="post" enctype="multipart/form-data">
        <div class="fw">
          <label for="file-input" id="fw-lbl" class="fwu">Select firmware binary file</label>
          <input id="file-input" type="file">
          <a id="update-btn" class="btn load submit icon-btn" title="Upload firmware">
            <span id="svg-update"></span>
          </a>
        </div>
      	<div class="pgw hide" id="pgr-wrap" data-pgr-style="fill-back">
      	  <div id="update-log"></div>
      	  <div class="pg" id="pgr-anim"></div>
      	</div>
      </form>
    </div>
    
    <h2 class="h2">Load file to ESP FileSystem</h2>
    <div class="tw">
      <form class="form" action="/edit" method="post" enctype="multipart/form-data">
        <ul id="listing"></ul>
        <label for="picker" id="pick-lbl" class="fwu">Select the folder containing your files</label>
        <input type="file" id="picker" name="fileList" webkitdirectory multiple>
        <p class="upload-note">N.B.: if folder name is <b>"/data"</b>, the files will be uploaded at root "/" level</p>
      </form>
    </div>
  </div>
  
  <hr id="btn-hr" class="hide">
  <div id="btn-box" class="bar hide">
    <a id="restart" class="btn">
      <div class="ic"><span id="svg-restart"></span></div>
        <span>Restart ESP</span>
    </a>
    <a id="save-params" class="btn">
      <div class="ic"><span id="svg-save"></span></div>
        <span>Save configuration</span>
    </a>
  </div>
  </main>
  
  <div class="ldr" id="loader">
  <div class="ldg">Loading...</div>
  <div class="sH"></div>
  <div class="sH s2H"></div>
  <div class="sH s3H"></div>
  <div class="sH s4H"></div>
  <div class="sH s5H"></div>
  </div>
  
  <details id="modal">
    <summary></summary>
    <div class="mod">
        <div class="mt"><h2 id="message-title">t</h2></div>
        <div class="mc"><p id="message-body"></p></div>
        <div class="bar">
            <a id="ok-modal" class="btn hide"><span>OK</span></a>
            <a id="close-modal" class="btn"><span>Close</span></a>
        </div>
    </div>
  </details>
  <footer class="foot">
    <hr>
    <a id="about" target="_blank" rel="noopener"></a>
  </footer>
</body>
</html>
